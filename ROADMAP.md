# CHTL 项目路线图

本文档旨在跟踪 CHTL 项目的开发进度，并为未来的工作提供一个清晰的指引。

## 已完成的工作

### 1. 项目审查与初始化
- **目标:** 审查项目代码，理解 `CHTL.md` 中的语言规范，并制定初步的开发计划。
- **成果:**
    - 深入分析了 `CHTL.md`，明确了 CHTL 和 CHTL JS 的各项功能。
    - 制定了一个多步骤的开发路线图，涵盖了从核心语言功能到 CLI 工具的完整开发流程。

### 2. 核心语言功能增强
- **目标:** 完善 CHTL 的核心解析器和词法分析器，修复 bug，确保其符合语言规范。
- **成果:**
    - **词法分析器:** 增强了对 `#` 符号的处理，使其能够同时支持生成器注释和 ID 选择器。
    - **解析器:**
        - 修复了 `parseTextNode` 中对无引号字面量和尾随标点的处理问题。
        - 增强了 `parseStyleRuleNode`，使其能够正确解析伪类选择器（如 `&:hover`）。
        - 完善了 `parseImportNode`，以支持按类型过滤导入的模板。

### 3. CHTL JS 解析器实现
- **目标:** 为 CHTL JS 实现一个基础但功能完备的解析器，为后续的生成器开发做准备。
- **成果:**
    - 为 `ScriptLoader`, `Listen`, `Delegate`, `Animate`, 和 `Vir` 等 CHTL JS 核心功能创建了对应的 AST 节点。
    - 在 CHTL JS 解析器中实现了对这些新功能的解析逻辑，能够将它们正确地转换成 AST。

### 4. 命令行界面 (CLI) 开发
- **目标:** 创建一个基础的 CLI 工具，使开发者能够从命令行编译 CHTL 文件。
- **成果:**
    - 开发了一个名为 `chtl` 的 CLI 应用程序。
    - 实现了 `compile` 命令，可以将指定的 `.chtl` 文件编译成 HTML，并输出到标准输出。
    - 确保了 CLI 工具的稳定性和可用性，并通过了所有相关测试。

### 5. “盐桥”通信机制
- **目标:** 实现 CHTL 和 CHTL JS 编译器之间的“盐桥”，允许它们在解析过程中进行数据交换和通信。
- **成果:**
    - **接口扩展:** 对 `SaltBridge` 接口进行了扩展，增加了对 `std::optional` 的支持以改进错误处理，并添加了类型安全的 `sendString` 和 `requestString` 方法。
    - **集成:** 将扩展后的“盐桥”成功集成到 CHTL 和 CHTL JS 的解析器与生成器中，确保了上下文信息（如父选择器）能够被正确传递。
    - **测试:** 编写了全面的测试用例，覆盖了数据传输、错误处理和边缘情况，确保了“盐桥”的稳定性和可靠性。

### 6. CHTL JS 生成器
- **目标:** 为 CHTL JS 开发一个代码生成器，将 CHTL JS 的 AST 转换成可执行的 JavaScript 代码。
- **成果:**
    - 为 `ScriptLoader`, `Listen`, `Delegate`, `Animate`, 和 `Vir` 等 AST 节点实现了 JavaScript 代码生成逻辑。
    - 将生成的 JavaScript 代码成功嵌入到最终的 HTML 文件中。

### 7. CMOD/CJMOD 模块系统
- **目标:** 完整实现 CMOD 和 CJMOD 二进制模块系统，包括打包、加载和解析。
- **任务:**
    - **序列化:** 创建一个将 CHTL AST 序列化为 `.cmod` 文件的工具或脚本。
    - **反序列化:** 在 `Loader::LoadModule` 中实现从 `.cmod` 和 `.cjmod` 文件中反序列化 AST 的逻辑。
    - **打包工具:** 根据 `CHTL.md` 中的规范，创建一个用于打包模块的脚本。

### 8. 文档与测试
- **目标:** 确保所有现有测试用例都能通过，并修复在开发过程中发现的所有 bug。
- **成果:**
    - **Doxygen 注释:** 为核心模块和类编写 Doxygen 风格的注释。
    - **贡献指南:** 撰写一份贡献指南，说明如何参与项目开发。
    - **测试:** 解决了 `LexerTest`, `ParserTest`, 和 `GeneratorTest` 中出现的所有失败用例。确保 `build.py` 脚本能够成功构建整个项目并通过所有测试，保证了代码库的稳定性。

## 下一步计划

### 1. 高级CHTL JS功能
- **目标:** 实现高级CHTL JS功能，以增强交互性和动态能力。
- **任务:**
    - **路由:** 实现`Router`，用于创建单页应用（SPA）。
    - **动态属性条件表达式:** 添加对基于运行时值变化的动态条件表达式的支持。
    - **响应式值:** 实现响应式值 (`$jsVariable$`)，以桥接CHTL和CHTL JS。
    - **`util...end` 表达式:** 实现`util...end`语法，用于处理条件逻辑。

### 2. 高级语言功能
- **目标:** 实现CHTL语言的高级功能，以提供更强的能力和灵活性。
- **任务:**
    - **约束 (`except`):** 添加对使用`except`关键字定义域约束的支持。
    - **配置组 (`[Configuration]`):** 实现配置组，允许开发者自定义语言行为。
    - **`use` 语法:** 实现`use`语法，用于指定配置组和文档类型。
    - **条件渲染 (`if`/`else if`/`else`):** 在元素内部添加对静态和动态条件渲染的支持。

### 3. VSCode 扩展
- **目标:** 开发一个VSCode扩展，为CHTL提供IDE功能，如语法高亮、代码补全和格式化。
- **任务:**
    - **语法高亮:** 为CHTL和CHTL JS创建语法高亮规则。
    - **代码补全:** 利用编译器的解析能力，提供代码补全和建议。
    - **格式化:** 实现代码格式化程序，以确保代码风格一致。
    - **模块集成:** 为CMOD/CJMOD模块添加自动模块解包和JSON查询表的支持。

### 4. 官方模块
- **目标:** 开发并发布官方的 `Chtholly` 和 `Yuigahama` 模块。
- **任务:**
    - **`Chtholly` 模块 (CMOD + CJMOD):**
        - 实现CMOD组件 (例如，手风琴、相册、进度条)。
        - 实现CJMOD功能 (`PrintMylove`, `INeverAway`)。
    - **`Yuigahama` 模块 (CMOD):**
        - 实现CMOD组件 (例如，音乐播放器、樱花雨特效)。

### 5. 构建与工具改进
- **目标:** 增强构建过程和开发者工具。
- **任务:**
    - **编译监视器:** 创建一个编译监视器，用于跟踪构建时间和内存使用情况。
    - **CLI 增强:** 为CLI添加更多功能，如`--inline`选项和项目脚手架支持。
    - **外部编译器集成:** 研究并集成外部CSS/JS编译器 (例如，ANTLR, libcss, V8)，以改进验证和处理能力。
