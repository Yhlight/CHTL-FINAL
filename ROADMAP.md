# CHTL 项目路线图

本文档旨在跟踪 CHTL 项目的开发进度，并为未来的工作提供一个清晰的指引。

## 已完成的工作

### 1. 项目审查与初始化 (已完成)
- **目标:** 审查项目代码，理解 `CHTL.md` 中的语言规范，并制定初步的开发计划。
- **成果:**
    - 深入分析了 `CHTL.md`，明确了 CHTL 和 CHTL JS 的各项功能。
    - 制定了一个多步骤的开发路线图，涵盖了从核心语言功能到 CLI 工具的完整开发流程。

### 2. 核心语言功能增强 (已完成)
- **目标:** 完善 CHTL 的核心解析器和词法分析器，修复 bug，确保其符合语言规范。
- **成果:**
    - **词法分析器:** 增强了对 `#` 符号的处理，使其能够同时支持生成器注释和 ID 选择器。
    - **解析器:**
        - 修复了 `parseTextNode` 中对无引号字面量和尾随标点的处理问题。
        - 增强了 `parseStyleRuleNode`，使其能够正确解析伪类选择器（如 `&:hover`）。
        - 完善了 `parseImportNode`，以支持按类型过滤导入的模板。

### 3. CHTL JS 解析器实现 (已完成)
- **目标:** 为 CHTL JS 实现一个基础但功能完备的解析器，为后续的生成器开发做准备。
- **成果:**
    - 为 `ScriptLoader`, `Listen`, `Delegate`, `Animate`, 和 `Vir` 等 CHTL JS 核心功能创建了对应的 AST 节点。
    - 在 CHTL JS 解析器中实现了对这些新功能的解析逻辑，能够将它们正确地转换成 AST。

### 4. 命令行界面 (CLI) 开发 (已完成)
- **目标:** 创建一个基础的 CLI 工具，使开发者能够从命令行编译 CHTL 文件。
- **成果:**
    - 开发了一个名为 `chtl` 的 CLI 应用程序。
    - 实现了 `compile` 命令，可以将指定的 `.chtl` 文件编译成 HTML，并输出到标准输出。
    - 确保了 CLI 工具的稳定性和可用性，并通过了所有相关测试。

### 5. “盐桥”通信机制 (已完成)
- **目标:** 实现 CHTL 和 CHTL JS 编译器之间的“盐桥”，允许它们在解析过程中进行数据交换和通信。
- **成果:**
    - **接口扩展:** 对 `SaltBridge` 接口进行了扩展，增加了对 `std::optional` 的支持以改进错误处理，并添加了类型安全的 `sendString` 和 `requestString` 方法。
    - **集成:** 将扩展后的“盐桥”成功集成到 CHTL 和 CHTL JS 的解析器与生成器中，确保了上下文信息（如父选择器）能够被正确传递。
    - **测试:** 编写了全面的测试用例，覆盖了数据传输、错误处理和边缘情况，确保了“盐桥”的稳定性和可靠性。

### 6. 测试与稳定性 (已完成)
- **目标:** 确保所有现有测试用例都能通过，并修复在开发过程中发现的所有 bug。
- **成果:**
    - 解决了 `LexerTest`, `ParserTest`, 和 `GeneratorTest` 中出现的所有失败用例。
    - 确保了 `build.py` 脚本能够成功构建整个项目并通过所有测试，保证了代码库的稳定性。

### 7. CHTL JS 生成器 (已完成)
- **目标:** 为 CHTL JS 开发一个代码生成器，将 CHTL JS 的 AST 转换成可执行的 JavaScript 代码。
- **成果:**
    - **生成器扩展:** 为 `ScriptLoader`, `Listen`, `Delegate`, `Animate`, 和 `Vir` 等 AST 节点实现了对应的 JavaScript 代码生成逻辑。
    - **测试覆盖:** 编写了全面的单元测试，确保生成的 JavaScript 代码符合预期。
    - **“盐桥”集成:** 在生成器中成功利用了“盐桥”机制，实现了 CHTL 和 CHTL JS 之间的上下文通信。

## 下一步计划

### 1. CMOD/CJMOD 模块系统 (已完成)
- **目标:** 完整实现 CMOD 和 CJMOD 二进制模块系统，包括打包、加载和解析。
- **任务:**
    - **序列化:** 为所有 AST 节点实现了序列化和反序列化功能。
    - **反序列化:** 在 `Loader::LoadModule` 中实现从 `.cmod` 和 `.cjmod` 文件中反序列化 AST 的逻辑。
    - **打包工具:** 根据 `CHTL.md` 中的规范，创建一个用于打包模块的脚本。

### 2. VSCode 扩展 (进行中)
- **目标:** 开发一个 VSCode 扩展，为 CHTL 提供语法高亮、代码提示和格式化等 IDE 功能。
- **进度:**
    - **基础项目创建 (已完成):** 搭建了 VSCode 扩展的基本目录结构和配置文件。
    - **语法高亮 (已完成):** 为 CHTL 和 CHTL JS 定义了 TextMate 语法规则，实现了关键字、注释、字符串等的基本高亮。
    - **语言服务器基础 (已完成):** 实现了语言服务器的基本框架，并提供了基础的关键字自动补全功能。
- **任务:**
    - 利用编译器的解析能力，为代码提示和自动补全提供支持。
    - 实现代码格式化功能。
    - 提供页面预览和实时预览功能。

### 3. 文档完善
- **目标:** 补充和完善项目文档，为新的贡献者提供指导。
- **任务:**
    - 为核心模块和类编写 Doxygen 风格的注释。
    - 撰写一份贡献指南，说明如何参与项目开发。
